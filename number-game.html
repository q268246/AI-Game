<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Number Crack - è„‘æ´å¤§å¼€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@700&display=swap');
        
        body {
            font-family: 'PingFang SC', -apple-system, BlinkMacSystemFont, sans-serif;
            overflow: hidden;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
        }

        .digital-font {
            font-family: 'JetBrains+Mono', monospace;
        }

        /* èƒŒæ™¯è¿‡æ¸¡åŠ¨ç”» */
        #bg-layer {
            transition: background-color 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* è§†è§‰å‹ç¼©æ¡æ ·å¼ */
        .compression-bar-container {
            height: 80px;
            background: rgba(0,0,0,0.2);
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid rgba(255,255,255,0.15);
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
        }

        /* æ— æ•ˆåŒºåŸŸ - æœºæ¢°è­¦ç¤ºçº¹ç† */
        .zone-excluded {
            position: absolute;
            height: 100%;
            top: 0;
            background: repeating-linear-gradient(
                135deg,
                #1a1a1a,
                #1a1a1a 10px,
                #2a2a2a 10px,
                #2a2a2a 20px
            );
            transition: width 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 10;
            border-right: 2px solid rgba(255,255,255,0.1); 
            border-left: 2px solid rgba(255,255,255,0.1);
        }
        
        /* è¢«é”æ­»çš„åŒºåŸŸå¢åŠ ä¸€ç§é‡‘å±è´¨æ„Ÿé®ç½© */
        .zone-excluded::after {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.6);
            box-shadow: inset 0 0 20px #000;
        }

        .active-marker {
            position: absolute;
            top: 0;
            width: 4px;
            height: 100%;
            background: #fff;
            box-shadow: 0 0 15px rgba(255,255,255,0.8);
            z-index: 20;
            transform: translateX(-50%);
            transition: left 0.1s linear;
        }

        /* è‡ªå®šä¹‰æ»‘å—æ ·å¼ */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
            height: 6px;
            border-radius: 3px;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 32px;
            width: 32px;
            border-radius: 50%;
            background: #ffffff;
            border: 4px solid rgba(0,0,0,0.1);
            cursor: pointer;
            margin-top: -14px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            transition: transform 0.1s;
        }

        input[type=range]::-webkit-slider-thumb:active {
            transform: scale(1.2);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: transparent;
            border-radius: 3px;
        }

        /* æŒ‰é’®ç‚¹å‡»æ€ */
        .btn-press:active {
            transform: scale(0.95);
            background-color: rgba(255,255,255,0.2);
        }

        /* èƒœåˆ©ç²’å­åŠ¨ç”»å®¹å™¨ */
        #particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* çŠ¶æ€æç¤ºæ ‡ç­¾ */
        .status-badge {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease-out;
        }
        .status-badge.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* é›·è¾¾å‘å…‰ç‰¹æ•ˆ */
        .egg-radar-weak {
            filter: drop-shadow(0 0 10px rgba(168,85,247,0.5));
            transition: all 0.3s;
        }
        .egg-radar-strong {
            filter: drop-shadow(0 0 20px rgba(236,72,153,0.9));
            animation: pulse-radar 0.8s ease-in-out infinite alternate;
        }
        @keyframes pulse-radar {
            0% { transform: scale(1); filter: drop-shadow(0 0 15px rgba(236,72,153,0.7)); }
            100% { transform: scale(1.05); filter: drop-shadow(0 0 25px rgba(236,72,153,1)); }
        }
    </style>
</head>
<body class="h-screen w-screen text-white flex flex-col relative bg-slate-900">

    <!-- èƒŒæ™¯é¢œè‰²å±‚ -->
    <div id="bg-layer" class="absolute inset-0 z-0 bg-slate-800"></div>

    <!-- ç²’å­å±‚ -->
    <canvas id="particles"></canvas>

    <!-- ä¸»ç•Œé¢ -->
    <div class="relative z-10 flex flex-col h-full max-w-md mx-auto p-6 justify-between safe-area-inset-bottom">
        
        <!-- A. é¢˜ç›®åŒº -->
        <header class="text-center mt-8 space-y-2">
            <div class="inline-block px-3 py-1 rounded-full bg-black/20 text-xs font-bold tracking-widest text-white/60 mb-2">
                DAILY CHALLENGE #042
            </div>
            <h1 class="text-2xl font-bold leading-tight">æˆå¹´äººå…¨èº«é€šå¸¸æœ‰å¤šå°‘å—éª¨å¤´ï¼Ÿ</h1>
            <div class="inline-block px-2 py-1 bg-white/10 rounded text-xs text-yellow-300 font-bold mb-1 border border-yellow-400/30">
                <i class="fas fa-crosshairs mr-1"></i> å…è®¸è¯¯å·®: Â±5
            </div>
            
            <p class="text-white/50 text-sm">èŒƒå›´: <span id="range-display">0 ~ 500</span></p>
        </header>

        <!-- B. è§†è§‰åé¦ˆåŒº -->
        <section class="flex-1 flex flex-col justify-center space-y-6">
            <!-- çŠ¶æ€æç¤ºè¯ (Feedback Text) -->
            <div id="feedback-container" class="h-8 flex justify-center items-center">
                <span id="feedback-text" class="status-badge px-4 py-1 rounded bg-black/30 font-bold tracking-widder text-sm backdrop-blur-sm border border-white/10">
                    <!-- JSåŠ¨æ€å¡«å…¥: TOO LOW / TOO HIGH -->
                </span>
            </div>

            <!-- æ ¸å¿ƒï¼šè§†è§‰å‹ç¼©æ¡ -->
            <div class="w-full relative">
                <div class="flex justify-between text-xs text-white/40 mb-1 digital-font">
                    <span id="global-min">0</span>
                    <span id="global-max">500</span>
                </div>
                
                <div class="compression-bar-container w-full" id="compression-bar">
                    <!-- å·¦ä¾§æ’é™¤åŒº -->
                    <div id="zone-left" class="zone-excluded left-0 w-0 border-r-2 border-white/20"></div>
                    
                    <!-- å³ä¾§æ’é™¤åŒº -->
                    <div id="zone-right" class="zone-excluded right-0 w-0 border-l-2 border-white/20"></div>

                    <!-- å½“å‰é€‰å€¼é”šç‚¹ -->
                    <div id="active-marker" class="active-marker left-1/2"></div>
                </div>

                <!-- å½“å‰æ•°å€¼å¤§æ˜¾ç¤º -->
                <div class="text-center mt-6">
                    <span id="current-value" class="digital-font text-6xl font-bold text-white drop-shadow-lg">250</span>
                </div>
            </div>
        </section>

        <!-- C. æ“ä½œåŒº -->
        <footer class="pb-8 space-y-6">
            <!-- æ»‘å— + å¾®è°ƒ -->
            <div class="bg-black/20 backdrop-blur-md rounded-2xl p-4 border border-white/5">
                <!-- ä¼ æ„Ÿå™¨æŒ‡ç¤ºå™¨ & å½©è›‹æ”¶é›†è¿›åº¦ -->
                <div class="mb-4 px-2 flex flex-col gap-3">
                    <div class="flex justify-between items-center">
                        <span class="text-[10px] text-white/40 uppercase tracking-widest"><i class="fas fa-thermometer-half"></i> ä¸»ç›®æ ‡çƒ­æ„Ÿ</span>
                        <span id="radar-status" class="text-[10px] text-purple-300/30 font-bold uppercase tracking-widest transition-all duration-300"><i class="fas fa-satellite-dish"></i> éšè—ç”Ÿç‰©é›·è¾¾</span>
                    </div>
                    <!-- å½©è›‹è¿›åº¦ UI (ç§»è‡³æ­¤å¤„ï¼Œé˜²è¯¯å¯¼å¹¶ä¸é›·è¾¾æ•´åˆ) -->
                    <div id="egg-tracker" class="flex justify-end gap-2 transition-all duration-300">
                        <div id="egg-cat" class="w-6 h-6 rounded-full bg-black/40 flex items-center justify-center grayscale opacity-40 transition-all duration-500 border border-white/10"><i class="fas fa-question text-white/30 text-[10px]"></i></div>
                        <div id="egg-baby" class="w-6 h-6 rounded-full bg-black/40 flex items-center justify-center grayscale opacity-40 transition-all duration-500 border border-white/10"><i class="fas fa-question text-white/30 text-[10px]"></i></div>
                        <div id="egg-dog" class="w-6 h-6 rounded-full bg-black/40 flex items-center justify-center grayscale opacity-40 transition-all duration-500 border border-white/10"><i class="fas fa-question text-white/30 text-[10px]"></i></div>
                    </div>
                </div>

                <!-- æ»‘å— -->
                <div class="mb-6 px-2 relative">
                    <input type="range" id="main-slider" min="0" max="500" value="250" step="1">
                </div>

                <!-- å¾®è°ƒæŒ‰é’® -->
                <div class="flex justify-between items-center gap-4">
                    <button id="btn-minus" class="btn-press w-16 h-16 rounded-xl bg-white/10 flex items-center justify-center text-2xl hover:bg-white/20 transition-colors touch-manipulation">
                        <i class="fas fa-minus"></i>
                    </button>
                    
                    <div class="text-xs text-white/40 uppercase tracking-widest text-center">
                        Fine Tune<br>
                        <span class="text-[10px] opacity-50">Hold for speed</span>
                    </div>

                    <button id="btn-plus" class="btn-press w-16 h-16 rounded-xl bg-white/10 flex items-center justify-center text-2xl hover:bg-white/20 transition-colors touch-manipulation">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </div>

            <!-- ç¡®è®¤æŒ‰é’® -->
            <button id="btn-guess" class="btn-press w-full py-5 bg-white text-slate-900 rounded-xl font-black text-xl tracking-widest uppercase shadow-[0_0_20px_rgba(255,255,255,0.3)] hover:shadow-[0_0_30px_rgba(255,255,255,0.5)] transition-all flex items-center justify-center gap-2">
                <i class="fas fa-fingerprint"></i> Guess
            </button>
        </footer>
    </div>

    <!-- å½©è›‹å‘ç° Toast -->
    <div id="egg-toast" class="pointer-events-none fixed top-[25%] left-1/2 transform -translate-x-1/2 scale-0 opacity-0 bg-gradient-to-br from-purple-600/95 to-pink-600/95 backdrop-blur-md p-6 rounded-2xl shadow-[0_10px_40px_rgba(168,85,247,0.5)] z-50 transition-all duration-500 text-center border border-white/30 min-w-[280px]">
        <div class="text-6xl mb-3 drop-shadow-lg" id="egg-toast-icon">ğŸ±</div>
        <div class="font-bold text-white text-xl tracking-wider mb-1" id="egg-toast-title">å‘ç°éšè—ç”Ÿç‰©ï¼</div>
        <div class="text-sm text-purple-100 font-medium" id="egg-toast-desc">çŒ«é€šå¸¸æœ‰230å—éª¨å¤´</div>
    </div>

    <!-- èƒœåˆ©å¼¹çª— -->
    <div id="victory-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-6">
        <div class="bg-slate-800 border border-yellow-500/30 p-8 rounded-2xl text-center shadow-2xl transform transition-all scale-100 max-w-sm w-full">
            <div class="text-6xl mb-4">ğŸ”“</div>
            <h2 class="text-3xl font-bold text-white mb-2">CRACKED!</h2>
            <p class="text-yellow-400 font-bold text-xl mb-4 digital-font" id="victory-number">ANSWER: 206</p>
            
            <div id="victory-desc-area">
                <!-- åŠ¨æ€å†…å®¹æ³¨å…¥åŒº -->
            </div>
        </div>
    </div>

    <script>
        // --- æ¸¸æˆé…ç½® ---
        const CONFIG = {
            globalMin: 0,
            globalMax: 500,
            targetNumber: 206, // æ¼”ç¤ºå›ºå®šå€¼ï¼Œå®é™…å¯éšæœº
            tolerance: 5,      // å…è®¸çš„è¯¯å·®èŒƒå›´ Â±5
            eggTolerance: 2,   // å½©è›‹è¯¯å·®èŒƒå›´æ›´ä¸¥æ ¼ï¼Œéœ€è¦æ›´ç²¾å‡†çš„æ¢ç´¢
            easterEggs: [
                { id: 'cat', value: 230, name: 'çŒ«å’ª', icon: 'ğŸ±', desc: 'çŒ«é€šå¸¸æœ‰ 230 å—éª¨å¤´', found: false },
                { id: 'baby', value: 300, name: 'äººç±»å©´å„¿', icon: 'ğŸ‘¶', desc: 'å©´å„¿å‡ºç”Ÿæ—¶çº¦æœ‰ 300 å—éª¨å¤´', found: false },
                { id: 'dog', value: 319, name: 'ç‹—ç‹—', icon: 'ğŸ¶', desc: 'ç‹—é€šå¸¸æœ‰ 319 å—éª¨å¤´', found: false }
            ],
            colors: {
                cold: '#3b82f6',   // blue-500
                warm: '#f97316',   // orange-500
                hot: '#ef4444',    // red-500
                neutral: '#1e293b' // slate-800
            }
        };

        // --- çŠ¶æ€ç®¡ç† ---
        let state = {
            currentMin: CONFIG.globalMin,
            currentMax: CONFIG.globalMax,
            currentVal: 250,
            isVictory: false,
            huntingMode: false // å¯»è›‹æ¨¡å¼æ ‡è®°
        };

        // --- DOM å…ƒç´  ---
        const els = {
            bgLayer: document.getElementById('bg-layer'),
            slider: document.getElementById('main-slider'),
            valDisplay: document.getElementById('current-value'),
            marker: document.getElementById('active-marker'),
            zoneLeft: document.getElementById('zone-left'),
            zoneRight: document.getElementById('zone-right'),
            rangeDisplay: document.getElementById('range-display'),
            feedbackBadge: document.getElementById('feedback-text'),
            victoryModal: document.getElementById('victory-modal'),
            victoryNum: document.getElementById('victory-number'),
            btnGuess: document.getElementById('btn-guess'),
            btnMinus: document.getElementById('btn-minus'),
            btnPlus: document.getElementById('btn-plus'),
            eggTracker: document.getElementById('egg-tracker'),
            radarStatus: document.getElementById('radar-status')
        };

        // --- åˆå§‹åŒ– ---
        function init() {
            // éšæœºç”Ÿæˆä¸€ä¸ªç›®æ ‡å€¼ç”¨äºæ¼”ç¤º (æˆ–è€…ä½¿ç”¨å›ºå®šå€¼æµ‹è¯•)
            // CONFIG.targetNumber = Math.floor(Math.random() * 501); 
            
            updateUI(false);
            setupEvents();
            setupStepper(els.btnMinus, -1);
            setupStepper(els.btnPlus, 1);
        }

        // --- æ ¸å¿ƒé€»è¾‘ï¼šæ›´æ–° UI ---
        function updateUI(animateSlider = true) {
            // 1. æ›´æ–°æ–‡æœ¬æ˜¾ç¤º
            els.slider.value = state.currentVal;
            els.valDisplay.textContent = state.currentVal;
            els.rangeDisplay.textContent = `${state.currentMin} ~ ${state.currentMax}`;

            const totalRange = CONFIG.globalMax - CONFIG.globalMin;
            
            // 1.5 æ¸²æŸ“æ»‘å—è½¨é“é«˜äº® (å…è®¸å…¨åŒºåŸŸæ‹–åŠ¨ï¼Œä½†é«˜äº®æœ‰æ•ˆåŒºåŸŸ)
            const activeLeftPct = ((state.currentMin - CONFIG.globalMin) / totalRange) * 100;
            const activeRightPct = ((state.currentMax - CONFIG.globalMin) / totalRange) * 100;
            
            els.slider.style.background = `linear-gradient(to right, 
                rgba(255,255,255,0.1) 0%, 
                rgba(255,255,255,0.1) ${activeLeftPct}%, 
                rgba(255,255,255,0.8) ${activeLeftPct}%, 
                rgba(255,255,255,0.8) ${activeRightPct}%, 
                rgba(255,255,255,0.1) ${activeRightPct}%, 
                rgba(255,255,255,0.1) 100%)`;

            // 2. æ›´æ–°è§†è§‰å‹ç¼©æ¡ (Visual Compression)
            // è®¡ç®—å·¦ä¾§æ— æ•ˆåŒºå®½åº¦ç™¾åˆ†æ¯”
            const leftPct = ((state.currentMin - CONFIG.globalMin) / totalRange) * 100;
            // è®¡ç®—å³ä¾§æ— æ•ˆåŒºå®½åº¦ç™¾åˆ†æ¯”
            const rightPct = ((CONFIG.globalMax - state.currentMax) / totalRange) * 100;

            els.zoneLeft.style.width = `${leftPct}%`;
            els.zoneRight.style.width = `${rightPct}%`;

            // 3. æ›´æ–°é”šç‚¹ä½ç½® (Marker)
            // Marker åº”è¯¥ç›¸å¯¹äºæ•´ä¸ªå®¹å™¨å®šä½
            const markerPct = ((state.currentVal - CONFIG.globalMin) / totalRange) * 100;
            els.marker.style.left = `${markerPct}%`;

            // 4. è®¡ç®—çƒ­åº¦é¢œè‰² (Thermal Color)
            if (!state.isVictory && !state.huntingMode) {
                updateThermalColor();
            }
            
            // 5. æ›´æ–°å½©è›‹é›·è¾¾æ¢æµ‹å™¨
            updateEggRadar();
        }

        function updateThermalColor() {
            if (state.huntingMode) return;
            
            // è®¡ç®—åˆ°ç›®æ ‡â€œè¾¹ç¼˜â€çš„è·ç¦»ï¼Œè€Œä¸æ˜¯ä¸­å¿ƒç‚¹
            let dist = 0;
            const targetMin = CONFIG.targetNumber - CONFIG.tolerance;
            const targetMax = CONFIG.targetNumber + CONFIG.tolerance;
            
            if (state.currentVal < targetMin) {
                dist = targetMin - state.currentVal;
            } else if (state.currentVal > targetMax) {
                dist = state.currentVal - targetMax;
            }

            const maxDist = CONFIG.globalMax - CONFIG.globalMin;
            const ratio = dist / maxDist; // 0 (æ’å¢™) ~ 1 (æœ€è¿œ) - å®é™…æœ€å¤§çº¦ 0.5-1.0
            
            // ç®€å•é˜ˆå€¼é€»è¾‘
            let color = CONFIG.colors.neutral;
            if (ratio > 0.4) {
                color = '#1e293b'; // è¿œ: æ·±è“ç°
            } else if (ratio > 0.15) {
                color = '#1e3a8a'; // è¾ƒè¿œ: è“
            } else if (ratio > 0.05) {
                color = '#c2410c'; // è¿‘: æ©™
            } else {
                color = '#7f1d1d'; // æè¿‘: æ·±çº¢
            }
            
            els.bgLayer.style.backgroundColor = color;
        }

        // --- æ–°å¢ï¼šå½©è›‹é›·è¾¾ç³»ç»Ÿ ---
        function updateEggRadar() {
            if (state.huntingMode) return; // å¯»è›‹æ¨¡å¼ä¸‹é›·è¾¾å…¨å¼€ï¼Œæ— éœ€æ¸è¿›æç¤º

            const unfoundEggs = CONFIG.easterEggs.filter(e => !e.found);
            if (unfoundEggs.length === 0) {
                els.radarStatus.innerHTML = '<i class="fas fa-check"></i> è®°å½•å·²å…¨æ”¶é›†';
                els.radarStatus.className = 'text-[10px] font-bold uppercase tracking-widest text-green-400/50 transition-all duration-300';
                els.eggTracker.classList.remove('egg-radar-weak', 'egg-radar-strong');
                return;
            }

            // è®¡ç®—è·ç¦»æœ€è¿‘çš„æœªå‘ç°å½©è›‹çš„è·ç¦»
            let minDist = Math.min(...unfoundEggs.map(e => Math.abs(state.currentVal - e.value)));

            if (minDist <= 10) {
                // æåº¦æ¥è¿‘ (å¼ºé›·è¾¾)
                els.radarStatus.innerHTML = '<i class="fas fa-broadcast-tower animate-pulse"></i> å‘ç°å¼‚å¸¸ç”Ÿç‰©ä¿¡å·ï¼';
                els.radarStatus.className = 'text-[10px] font-bold uppercase tracking-widest text-pink-400 drop-shadow-[0_0_8px_rgba(244,114,182,0.8)] transition-all duration-300 animate-pulse';
                els.eggTracker.classList.remove('egg-radar-weak');
                els.eggTracker.classList.add('egg-radar-strong');
            } else if (minDist <= 40) {
                // é™„è¿‘æœ‰ä¿¡å· (å¼±é›·è¾¾)
                els.radarStatus.innerHTML = '<i class="fas fa-satellite-dish"></i> æ¢æµ‹åˆ°å¾®å¼±ç”Ÿç‰©æ³¢...';
                els.radarStatus.className = 'text-[10px] font-bold uppercase tracking-widest text-purple-400 drop-shadow-[0_0_5px_rgba(192,132,252,0.5)] transition-all duration-300';
                els.eggTracker.classList.remove('egg-radar-strong');
                els.eggTracker.classList.add('egg-radar-weak');
            } else {
                // æ— ä¿¡å·
                els.radarStatus.innerHTML = '<i class="fas fa-satellite-dish"></i> éšè—ç”Ÿç‰©é›·è¾¾';
                els.radarStatus.className = 'text-[10px] font-bold uppercase tracking-widest text-purple-300/30 transition-all duration-300';
                els.eggTracker.classList.remove('egg-radar-weak', 'egg-radar-strong');
            }
        }

        // --- æ ¸å¿ƒé€»è¾‘ï¼šçŒœæµ‹åˆ¤å®š ---
        function handleGuess() {
            const guess = parseInt(state.currentVal);
            const target = CONFIG.targetNumber;
            const tol = CONFIG.tolerance;

            // 1. æ£€æŸ¥æ˜¯å¦è§¦å‘å½©è›‹
            let foundNewEgg = false;
            CONFIG.easterEggs.forEach(egg => {
                if (!egg.found && Math.abs(guess - egg.value) <= CONFIG.eggTolerance) {
                    egg.found = true;
                    foundNewEgg = true;
                    showEggToast(egg);
                    updateEggUI(egg);
                }
            });

            // å¯»è›‹æ¨¡å¼ä¸‹ï¼šåªæ‰¾å½©è›‹ï¼Œä¸ç®¡ä¸»çº¿
            if (state.huntingMode) {
                if (!foundNewEgg) {
                    showFeedback('<i class="fas fa-times-circle mr-1"></i> æœªé”å®šç”Ÿç‰©ï¼Œè¯·æ ¹æ®é›·è¾¾æŒ‡ç¤ºç§»åŠ¨', 'text-red-300');
                    document.body.classList.add('shake');
                    setTimeout(() => document.body.classList.remove('shake'), 500);
                }
                
                // æ£€æŸ¥æ˜¯å¦å…¨æ”¶é›†
                if (CONFIG.easterEggs.every(e => e.found)) {
                    setTimeout(() => showAllEggsFound(), foundNewEgg ? 2000 : 0);
                }
                return; // ç»ˆæ­¢å‡½æ•°ï¼Œä¸æ‰§è¡Œåç»­ä¸»çº¿é€»è¾‘
            }

            // 1.5 åˆ¤æ–­æ˜¯å¦åœ¨æ— æ•ˆåŒºåŸŸä¹±çŒœ
            if (!foundNewEgg && (guess < state.currentMin || guess > state.currentMax)) {
                showFeedback('<i class="fas fa-ban mr-2"></i> è¯¥åŒºåŸŸå·²è¢«æ’é™¤ï¼Œæœªå‘ç°ç”Ÿç‰©', 'text-gray-400');
                document.body.classList.add('shake');
                setTimeout(() => document.body.classList.remove('shake'), 500);
                return; // åœ¨åºŸå¼ƒåŒºåŸŸæ²¡æ‰«åˆ°å½©è›‹ï¼Œç›´æ¥è¿”å›ï¼Œä¸å½±å“ä¸»çº¿è¿›åº¦
            }

            // 2. ä¸»çº¿é€»è¾‘æ£€æŸ¥ (æ˜¯å¦è½å…¥å…è®¸çš„è¯¯å·®åŒºé—´å†…)
            if (Math.abs(guess - target) <= tol) {
                // å¦‚æœåˆšå¥½æ—¢æ‰¾åˆ°äº†å½©è›‹åˆé€šå…³ä¸»çº¿ï¼Œç»™å½©è›‹åŠ¨ç”»ç•™ç‚¹æ—¶é—´
                setTimeout(() => victory(), foundNewEgg ? 1500 : 0);
            } else {
                // é”™è¯¯åé¦ˆ
                let msg = "";
                let icon = "";
                
                if (guess < target - tol) {
                    msg = "TOO LOW / å¤ªå°äº†";
                    icon = '<i class="fas fa-arrow-up mr-2"></i>';
                    // ç¡®ä¿æœ€å°å€¼åªèƒ½å¢åŠ ï¼Œé˜²æ­¢åå¼¹
                    state.currentMin = Math.max(state.currentMin, Math.min(guess + 1, target + tol)); 
                } else {
                    msg = "TOO HIGH / å¤ªå¤§äº†";
                    icon = '<i class="fas fa-arrow-down mr-2"></i>';
                    // ç¡®ä¿æœ€å¤§å€¼åªèƒ½å‡å°ï¼Œé˜²æ­¢åå¼¹
                    state.currentMax = Math.min(state.currentMax, Math.max(guess - 1, target - tol));
                }

                // å¦‚æœæ²¡æ‰¾åˆ°å½©è›‹ï¼Œæ‰æ˜¾ç¤ºä¸»çº¿é”™è¯¯åé¦ˆï¼Œé˜²æ­¢è¦†ç›–å½©è›‹çš„å–œæ‚¦
                if (!foundNewEgg) {
                    showFeedback(icon + msg, guess < target ? 'text-blue-300' : 'text-orange-300');
                }
                
                document.body.classList.add('shake');
                setTimeout(() => document.body.classList.remove('shake'), 500);

                updateUI();
            }
        }

        function showFeedback(html, colorClass) {
            const el = els.feedbackBadge;
            el.innerHTML = html;
            el.className = `status-badge px-4 py-1 rounded bg-black/50 font-bold tracking-widest text-sm backdrop-blur-sm border border-white/20 show ${colorClass}`;
            
            // 2ç§’åæ·¡å‡ºï¼Œé™¤éæœ‰æ–°çš„
            if (window.feedbackTimer) clearTimeout(window.feedbackTimer);
            window.feedbackTimer = setTimeout(() => {
                if (!state.huntingMode) {
                    el.classList.remove('show');
                } else {
                    // å¯»è›‹æ¨¡å¼ä¸‹ä¸éšè—ï¼Œæ¢å¤å®æ—¶é›·è¾¾æŒ‡ç¤º
                    handleHuntingRadar(state.currentVal);
                }
            }, 2000);
        }

        function victory() {
            state.isVictory = true;
            els.bgLayer.style.backgroundColor = '#10b981'; // Success Green
            
            els.victoryNum.innerHTML = `ç­”æ¡ˆ: ${CONFIG.targetNumber}<br><span class="text-sm text-yellow-100 block mt-2 opacity-80 font-normal">ä½ çš„çŒœæµ‹: ${state.currentVal} (è¯¯å·®åœ¨ Â±${CONFIG.tolerance} å†…)</span>`;
            
            // æ„å»ºå½©è›‹çŠ¶æ€ç›¸å…³çš„æè¿°å’ŒæŒ‰é’®
            const foundCount = CONFIG.easterEggs.filter(e => e.found).length;
            const totalEggs = CONFIG.easterEggs.length;
            const descArea = document.getElementById('victory-desc-area');
            
            let contentHtml = '';
            if (foundCount === totalEggs) {
                contentHtml = `
                    <p class="text-white/70 mb-4">ç ´è§£æˆåŠŸï¼å‡»è´¥äº†å…¨çƒ 85% çš„ç©å®¶ã€‚</p>
                    <div class="bg-purple-900/40 border border-purple-500/30 rounded-lg p-3 mb-6">
                        <p class="text-purple-300 font-bold text-sm">âœ¨ å¤§æ»¡è´¯è¾¾æˆï¼</p>
                        <p class="text-purple-200/70 text-xs mt-1">ä½ æ‰¾é½äº†æ‰€æœ‰éšè—çš„ç”Ÿç‰©éª¨éª¼è®°å½•ï¼</p>
                    </div>
                    <button onclick="location.reload()" class="w-full py-4 bg-yellow-500 hover:bg-yellow-400 text-black font-bold text-lg rounded-xl transition-colors shadow-lg">ä¸‹ä¸€é¢˜</button>
                `;
            } else {
                contentHtml = `
                    <p class="text-white/70 mb-4">ç ´è§£æˆåŠŸï¼å‡»è´¥äº†å…¨çƒ 85% çš„ç©å®¶ã€‚</p>
                    <div class="bg-black/30 rounded-lg p-3 mb-6 text-sm">
                        <span class="text-yellow-400 font-bold">æç¤º:</span> é¢˜åº“ä¸­è¿˜éšè—ç€ <strong class="text-purple-400 text-lg">${totalEggs - foundCount}</strong> ä¸ªå…¶ä»–ç”Ÿç‰©çš„éª¨å¤´æ•°é‡æœªè¢«å‘ç°...
                    </div>
                    <button onclick="continueHunting()" class="w-full py-4 mb-3 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white font-bold text-lg rounded-xl transition-all shadow-[0_0_20px_rgba(168,85,247,0.4)] border border-purple-400/50 flex justify-center items-center gap-2">
                        <i class="fas fa-radar"></i> ç»§ç»­å¯»æ‰¾å½©è›‹
                    </button>
                    <div class="flex gap-3">
                        <button onclick="revealAllEggs()" class="flex-1 py-3 bg-white/10 hover:bg-white/20 text-white/90 font-bold rounded-xl transition-colors text-sm flex justify-center items-center gap-2 border border-white/10">
                            <i class="fas fa-eye text-white/50"></i> çœ‹ç­”æ¡ˆ
                        </button>
                        <button onclick="location.reload()" class="flex-1 py-3 bg-white/5 hover:bg-white/10 text-white/60 font-bold rounded-xl transition-colors text-sm">ä¸‹ä¸€é¢˜</button>
                    </div>
                `;
            }
            
            descArea.innerHTML = contentHtml;
            els.victoryModal.classList.remove('hidden');
            fireParticles('#10b981'); // ç»¿è‰²ç²’å­
        }

        // --- å½©è›‹æ‰©å±•é€»è¾‘ ---
        function continueHunting() {
            els.victoryModal.classList.add('hidden');
            state.huntingMode = true;
            state.isVictory = false; // è§£é™¤èƒœåˆ©èƒŒæ™¯é”å®š
            
            // å®Œå…¨è§£å¼€èŒƒå›´é™åˆ¶ï¼Œå…è®¸å…¨å›¾æ‰«æ
            state.currentMin = CONFIG.globalMin;
            state.currentMax = CONFIG.globalMax;
            
            // é‡ç½®è§†è§‰æ¡
            els.zoneLeft.style.width = '0%';
            els.zoneRight.style.width = '0%';
            els.bgLayer.style.backgroundColor = '#1e293b'; // å˜å›ä¸­æ€§è‰²
            
            // æ”¹å˜ä¸»æŒ‰é’®æ ·å¼
            els.btnGuess.innerHTML = '<i class="fas fa-search"></i> SCAN EGGS';
            els.btnGuess.className = "btn-press w-full py-5 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-black text-xl tracking-widest uppercase shadow-[0_0_20px_rgba(168,85,247,0.5)] transition-all flex items-center justify-center gap-2";
            
            // å¢åŠ â€œæ”¾å¼ƒå¯»æ‰¾ï¼ŒæŸ¥çœ‹ç­”æ¡ˆâ€æŒ‰é’®åœ¨ footer
            const footer = document.querySelector('footer');
            if (!document.getElementById('btn-giveup-hunting')) {
                const giveUpBtn = document.createElement('button');
                giveUpBtn.id = 'btn-giveup-hunting';
                giveUpBtn.className = "w-full mt-4 py-3 bg-transparent text-white/40 hover:text-white/80 rounded-xl font-bold text-sm transition-colors flex items-center justify-center gap-2";
                giveUpBtn.innerHTML = '<i class="fas fa-eye"></i> æ‰¾ä¸åˆ°ï¼Ÿç›´æ¥çœ‹ç­”æ¡ˆ';
                giveUpBtn.onclick = revealAllEggs;
                footer.appendChild(giveUpBtn);
            }

            updateUI();
            handleHuntingRadar(state.currentVal); // ç«‹å³è§¦å‘å¯»è›‹é›·è¾¾æ˜¾ç¤º
        }

        function revealAllEggs() {
            // æ¸²æŸ“å¹¶æ­ç¤ºæ‰€æœ‰æœªå‘ç°çš„å½©è›‹
            CONFIG.easterEggs.forEach(egg => {
                updateEggUI(egg); // Reveal the icons at the top
            });

            els.victoryNum.innerHTML = `å½©è›‹å·²æ­æ™“`;
            
            const descArea = document.getElementById('victory-desc-area');
            
            let detailsHtml = CONFIG.easterEggs.map(e => {
                const statusColor = e.found ? 'text-green-400' : 'text-purple-300';
                const statusIcon = e.found ? '<i class="fas fa-check-circle"></i>' : '<i class="fas fa-eye"></i>';
                return `
                <div class="flex justify-between items-center bg-black/40 p-3 rounded-lg mb-2 text-sm border border-white/5">
                    <span class="flex items-center gap-2"><span class="text-xl">${e.icon}</span> ${e.name}</span>
                    <div class="flex items-center gap-3">
                        <span class="font-bold ${statusColor} digital-font text-lg">${e.value}</span>
                        <span class="text-xs ${statusColor} opacity-70">${statusIcon}</span>
                    </div>
                </div>`;
            }).join('');

            descArea.innerHTML = `
                <div class="mb-6 mt-4 text-left">
                    ${detailsHtml}
                </div>
                <button onclick="location.reload()" class="w-full py-4 bg-yellow-500 hover:bg-yellow-400 text-black font-bold text-lg rounded-xl transition-colors shadow-lg">è¿›å…¥ä¸‹ä¸€é¢˜</button>
            `;

            els.bgLayer.style.backgroundColor = '#1e293b'; 
            els.victoryModal.classList.remove('hidden');

            // éšè—åº•éƒ¨å¯èƒ½å­˜åœ¨çš„æ”¾å¼ƒæŒ‰é’®
            const btn = document.getElementById('btn-giveup-hunting');
            if(btn) btn.style.display = 'none';
        }

        // --- å¯»è›‹æ¨¡å¼é›·è¾¾å¢å¼ºæŒ‡å¼• (Geiger Counter) ---
        function handleHuntingRadar(val) {
            if (!state.huntingMode) return;
            const unfoundEggs = CONFIG.easterEggs.filter(e => !e.found);
            if (unfoundEggs.length === 0) return;

            // å¯»æ‰¾æœ€è¿‘çš„å½©è›‹
            let closestEgg = unfoundEggs.reduce((prev, curr) =>
                Math.abs(val - curr.value) < Math.abs(val - prev.value) ? curr : prev
            );
            let dist = Math.abs(val - closestEgg.value);

            const el = els.feedbackBadge;
            if (window.feedbackTimer) clearTimeout(window.feedbackTimer); // é˜»æ­¢ auto-hide

            if (dist <= CONFIG.eggTolerance) {
                el.innerHTML = `<i class="fas fa-bullseye animate-ping mr-2"></i> é”å®šç›®æ ‡ï¼ç‚¹å‡» GUESSï¼`;
                el.className = `status-badge px-4 py-1 rounded bg-pink-600 font-bold tracking-widest text-sm backdrop-blur-sm border border-pink-400 show text-white shadow-[0_0_15px_rgba(236,72,153,0.8)]`;
            } else if (dist <= 20) {
                let dir = val < closestEgg.value ? 'å¢åŠ æ•°å€¼ <i class="fas fa-chevron-right"></i>' : '<i class="fas fa-chevron-left"></i> å‡å°æ•°å€¼';
                el.innerHTML = `<i class="fas fa-signal text-pink-300 mr-1"></i> å¼ºä¿¡å·ï¼${dir}`;
                el.className = `status-badge px-4 py-1 rounded bg-purple-600/90 font-bold tracking-widest text-sm backdrop-blur-sm border border-purple-400 show text-white`;
            } else if (dist <= 60) {
                let dir = val < closestEgg.value ? 'å‘å³ <i class="fas fa-arrow-right"></i>' : '<i class="fas fa-arrow-left"></i> å‘å·¦';
                el.innerHTML = `<i class="fas fa-satellite-dish mr-1"></i> å‘ç°å¾®å¼±æ³¢æ®µ... ${dir}`;
                el.className = `status-badge px-4 py-1 rounded bg-purple-900/80 font-bold tracking-widest text-sm backdrop-blur-sm border border-purple-500/50 show text-purple-200`;
            } else {
                el.innerHTML = `<i class="fas fa-search mr-1"></i> æ­£åœ¨è¿›è¡Œå…¨é¢‘æ®µæ‰«æ...`;
                el.className = `status-badge px-4 py-1 rounded bg-black/50 font-bold tracking-widest text-sm backdrop-blur-sm border border-white/20 show text-gray-400`;
            }
        }

        function showEggToast(egg) {
            const toast = document.getElementById('egg-toast');
            document.getElementById('egg-toast-icon').textContent = egg.icon;
            document.getElementById('egg-toast-desc').textContent = egg.desc;
            
            // å¼¹å‡ºåŠ¨ç”»
            toast.classList.remove('scale-0', 'opacity-0');
            toast.classList.add('scale-100', 'opacity-100', 'translate-y-[-20px]');
            
            // éœ‡åŠ¨
            document.body.classList.add('shake');
            setTimeout(() => document.body.classList.remove('shake'), 500);
            
            // ç´«è‰²ç²’å­åº†ç¥
            fireParticles('#a855f7', 50); 
            
            // 3ç§’åæ”¶èµ·
            setTimeout(() => {
                toast.classList.remove('scale-100', 'opacity-100', 'translate-y-[-20px]');
                toast.classList.add('scale-0', 'opacity-0');
            }, 3000);
        }

        function updateEggUI(egg) {
            const el = document.getElementById(`egg-${egg.id}`);
            if(el) {
                el.classList.remove('grayscale', 'opacity-40', 'bg-black/40', 'border-white/10');
                el.classList.add('bg-purple-500/30', 'border-purple-400', 'shadow-[0_0_15px_rgba(168,85,247,0.6)]');
                el.innerHTML = `<span class="text-xl">${egg.icon}</span>`;
            }
        }

        function showAllEggsFound() {
            els.victoryNum.innerHTML = `å½©è›‹å…¨æ”¶é›†ï¼<br><span class="text-sm text-purple-200 block mt-2 opacity-80 font-normal">ä½ æ˜¯ä¸€ä½ä¼Ÿå¤§çš„ç”Ÿç‰©å­¦å®¶</span>`;
            
            const descArea = document.getElementById('victory-desc-area');
            descArea.innerHTML = `
                <div class="flex justify-center gap-4 text-4xl mb-6 mt-4">ğŸ± ğŸ‘¶ ğŸ¶</div>
                <button onclick="location.reload()" class="w-full py-4 bg-yellow-500 hover:bg-yellow-400 text-black font-bold text-lg rounded-xl transition-colors shadow-lg">è¿›å…¥ä¸‹ä¸€é¢˜</button>
            `;
            
            els.bgLayer.style.backgroundColor = '#4c1d95'; // æ·±ç´«è‰²èƒŒæ™¯
            els.victoryModal.classList.remove('hidden');
            fireParticles('#eab308', 150); // é‡‘è‰²å¤§çˆ†å‘
        }

        // --- äº‹ä»¶ç›‘å¬ ---
        function setupEvents() {
            // æ»‘å—æ‹–åŠ¨
            els.slider.addEventListener('input', (e) => {
                state.currentVal = parseInt(e.target.value);
                // å®æ—¶æ›´æ–°UIä½†ä¸æ”¹å˜èŒƒå›´
                const totalRange = CONFIG.globalMax - CONFIG.globalMin;
                const markerPct = ((state.currentVal - CONFIG.globalMin) / totalRange) * 100;
                els.marker.style.left = `${markerPct}%`;
                els.valDisplay.textContent = state.currentVal;
                
                if (!state.isVictory && !state.huntingMode) {
                    updateThermalColor(); // æ‹–åŠ¨æ—¶ä¸»çº¿çƒ­åº¦åé¦ˆ
                }
                updateEggRadar(); // æ‹–åŠ¨æ—¶å½©è›‹é›·è¾¾åé¦ˆ

                // å¯»è›‹æ¨¡å¼ä¸‹çš„å¼ºåŠ›æŒ‡å¼•åé¦ˆ
                if (state.huntingMode) {
                    handleHuntingRadar(state.currentVal);
                }
            });

            // çŒœæµ‹æŒ‰é’®
            els.btnGuess.addEventListener('click', handleGuess);
        }

        // --- é•¿æŒ‰å¾®è°ƒé€»è¾‘ ---
        function setupStepper(btn, change) {
            let interval;
            let timeout;
            let speed = 200; // åˆå§‹é€Ÿåº¦

            const update = () => {
                let newVal = state.currentVal + change;
                // è§£é™¤å¾®è°ƒæŒ‰é’®çš„å±€éƒ¨èŒƒå›´é™åˆ¶ï¼Œå…è®¸åœ¨å…¨å›¾ 0-500 æ¢ç´¢å½©è›‹
                if (newVal >= CONFIG.globalMin && newVal <= CONFIG.globalMax) {
                    state.currentVal = newVal;
                    // æ‰‹åŠ¨è§¦å‘æ»‘å—æ›´æ–°
                    els.slider.value = state.currentVal;
                    els.slider.dispatchEvent(new Event('input'));
                }
            };

            const start = (e) => {
                e.preventDefault(); // é˜²æ­¢ç§»åŠ¨ç«¯é•¿æŒ‰é€‰ä¸­æ–‡æœ¬
                update(); // ç‚¹å‡»ç«‹å³è§¦å‘ä¸€æ¬¡
                timeout = setTimeout(() => {
                    speed = 100;
                    interval = setInterval(() => {
                        update();
                        // åŠ é€Ÿé€»è¾‘
                        if (speed > 20) {
                            speed -= 10;
                            clearInterval(interval);
                            interval = setInterval(update, speed);
                        }
                    }, speed);
                }, 400); // 400ms åå¼€å§‹è¿å‘
            };

            const stop = () => {
                clearTimeout(timeout);
                clearInterval(interval);
                speed = 200;
            };

            // é¼ æ ‡
            btn.addEventListener('mousedown', start);
            btn.addEventListener('mouseup', stop);
            btn.addEventListener('mouseleave', stop);
            // è§¦æ‘¸
            btn.addEventListener('touchstart', start, {passive: false});
            btn.addEventListener('touchend', stop);
        }

        // --- ç®€å•ç²’å­ç³»ç»Ÿ ---
        function fireParticles(baseColor = null, count = 100) {
            const canvas = document.getElementById('particles');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const particles = [];
            for (let i = 0; i < count; i++) {
                // å¦‚æœæ²¡æœ‰æä¾› baseColorï¼Œå°±ç”¨å½©è‰²çš„ï¼Œå¦‚æœæä¾›äº†ï¼Œå°±ç”¨æä¾›é¢œè‰²çš„å˜ç§
                let pColor = `hsl(${Math.random() * 60 + 40}, 100%, 50%)`; // Default Gold
                
                if (baseColor === '#10b981') { // ç»¿
                    pColor = `hsl(${Math.random() * 40 + 130}, 100%, 60%)`;
                } else if (baseColor === '#a855f7') { // ç´«
                    pColor = `hsl(${Math.random() * 40 + 260}, 100%, 70%)`;
                } else if (baseColor === '#eab308') { // çº¯é‡‘
                    pColor = `hsl(${Math.random() * 30 + 40}, 100%, 60%)`;
                }

                particles.push({
                    x: canvas.width / 2,
                    y: canvas.height / 2,
                    vx: (Math.random() - 0.5) * 15,
                    vy: (Math.random() - 0.5) * 15,
                    life: 1,
                    color: pColor
                });
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                let active = false;
                particles.forEach(p => {
                    if (p.life > 0) {
                        active = true;
                        p.x += p.vx;
                        p.y += p.vy;
                        p.vy += 0.2; // Gravity
                        p.life -= 0.02;
                        ctx.globalAlpha = p.life;
                        ctx.fillStyle = p.color;
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, 4, 0, Math.PI * 2);
                        ctx.fill();
                    }
                });
                if (active) requestAnimationFrame(animate);
            }
            animate();
        }

        // å¯åŠ¨
        init();

    </script>
</body>
</html>